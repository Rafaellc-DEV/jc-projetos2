{% extends "base.html" %}
{% load static %}

{% block title %}P√°gina Inicial - JC Online{% endblock %}

{% block extra_head %}
<style>
  /* Placeholder de foto */
  .ph-foto {
    width: 100%;
    aspect-ratio: 1 / 1; ¬† /* quadrado */
    background: #f1f1f1;
    border-radius: 30px;
    display: grid;
    place-items: center;
    color: #666;
    font-weight: 600;
    letter-spacing: .2px;
    user-select: none;
  }

  /* üî• D√° um respiro do topo (navbar j√° √© maior) */
  main.container {
    padding-top: 24px;
  }
</style>
{% endblock %}

{% block content %}
<div class="text-center py-5">
  <h1 class="mb-4">Bem-vindo ao JC Online</h1>
  <p class="lead">Aqui voc√™ encontra as principais not√≠cias de Pernambuco e do Brasil.</p>

  <hr class="my-4">

  <div class="row">
    
    <div class="col-md-4">
      <div class="card shadow-sm mb-4">
        <div class="ph-foto">Foto not√≠cia 1</div>
        <div class="card-body">
          <h5 class="card-title">Not√≠cia 1</h5>
          <p class="card-text">Resumo da not√≠cia 1 para chamar a aten√ß√£o do leitor.</p>
          <a href="#" class="btn btn-primary btn-sm">Ler mais</a>
          
          <button type="button" 
                  class="btn btn-outline-secondary btn-sm ms-2" 
                  data-bs-toggle="modal" 
                  data-bs-target="#modalComentario"
                  data-noticia-id="1" 
                  data-noticia-titulo="Not√≠cia 1">
            Comentar
          </button>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm mb-4">
        <div class="ph-foto">Foto not√≠cia 2</div>
        <div class="card-body">
          <h5 class="card-title">Not√≠cia 2</h5>
          <p class="card-text">Resumo da not√≠cia 2 para chamar a aten√ß√£o do leitor.</p>
          <a href="#" class="btn btn-primary btn-sm">Ler mais</a>
          <button type="button" 
                  class="btn btn-outline-secondary btn-sm ms-2" 
                  data-bs-toggle="modal" 
                  data-bs-target="#modalComentario"
                  data-noticia-id="2" 
                  data-noticia-titulo="Not√≠cia 2">
            Comentar
          </button>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm mb-4">
        <div class="ph-foto">Foto not√≠cia 3</div>
        <div class="card-body">
          <h5 class="card-title">Not√≠cia 3</h5>
          <p class="card-text">Resumo da not√≠cia 3 para chamar a aten√ß√£o do leitor.</p>
          <a href="#" class="btn btn-primary btn-sm">Ler mais</a>
          <button type="button" 
                  class="btn btn-outline-secondary btn-sm ms-2" 
                  data-bs-toggle="modal" 
                  data-bs-target="#modalComentario"
                  data-noticia-id="3" 
                  data-noticia-titulo="Not√≠cia 3">
            Comentar
          </button>
        </div>
      </div>
    </div>
    
  </div>
</div>

<div class="modal fade" id="modalComentario" tabindex="-1" aria-labelledby="modalComentarioLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalComentarioLabel">Deixar um Coment√°rio em "<span id="noticiaTituloModal"></span>"</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        
        <div class="mb-3 text-center">
            <button id="btnCurtir" class="btn btn-outline-danger">
                ‚ù§Ô∏è Curtiu? Deixe seu Like!
            </button>
        </div>
        <hr>

        <form id="formComentario" method="POST" data-url="{% url 'adicionar_comentario_ajax' %}">
            {% csrf_token %}
            
            <div id="formFieldsContainer">
                <div class="mb-3">
                    <label for="id_autor" class="form-label">Seu Nome:</label>
                    <input type="text" class="form-control" id="id_autor" name="autor" required>
                </div>
                <div class="mb-3">
                    <label for="id_texto" class="form-label">Coment√°rio:</label>
                    <textarea class="form-control" id="id_texto" name="texto" rows="3" required></textarea>
                </div>
            </div>
            
            <input type="hidden" id="noticia_id" name="noticia_id" value=""> 

            <button type="submit" class="btn btn-success mt-3">Enviar Coment√°rio</button>
        </form>

        <div id="mensagemSucesso" class="alert alert-success mt-3" style="display:none;">
            Enviado com sucesso!
        </div>

      </div>
    </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> 
<script>
$(document).ready(function() {
    // 1. L√ìGICA PARA PASSAR O ID E O T√çTULO DA NOT√çCIA PARA O MODAL
    $('#modalComentario').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Bot√£o que disparou o modal
        var noticiaId = button.data('noticia-id'); 
        var noticiaTitulo = button.data('noticia-titulo'); 
        
        // Coloca o ID no campo oculto do formul√°rio
        $('#noticia_id').val(noticiaId); 
        // Atualiza o t√≠tulo no cabe√ßalho do modal
        $('#noticiaTituloModal').text(noticiaTitulo);
        
        // Reseta o estado do modal se j√° foi usado
        $('#formComentario').show(); 
        $('#mensagemSucesso').hide();
        $('#btnCurtir').prop('disabled', false).text('‚ù§Ô∏è Curtiu? Deixe seu Like!');
    });

    // 2. L√ìGICA DO BOT√ÉO CURTIR (LIKE) - Apenas demonstra√ß√£o no front-end
    $('#btnCurtir').click(function() {
        // No mundo real, isso faria uma chamada AJAX para salvar o like no banco
        $(this).prop('disabled', true).text('‚ù§Ô∏è Voc√™ curtiu!'); 
    });


    // 3. L√ìGICA DO ENVIO DO FORMUL√ÅRIO (AJAX)
    $('#formComentario').submit(function(e) {
        e.preventDefault(); // Impede o envio tradicional (recarregamento)
        var form = $(this);
        var url = form.data('url'); 

        $.ajax({
            type: "POST",
            url: url,
            data: form.serialize(), // Envia todos os dados do formul√°rio
            success: function(response) {
                if (response.sucesso) {
                    // Limpa o formul√°rio e mostra a mensagem de sucesso
                    form[0].reset();
                    form.hide(); 
                    $('#mensagemSucesso').text(response.mensagem).show(); 
                    
                    // Opcional: Fechar o modal ap√≥s 3 segundos
                    setTimeout(function(){
                        $('#modalComentario').modal('hide');
                    }, 3000); 

                } else {
                    alert('Erro ao enviar: ' + response.erros);
                }
            },
            error: function() {
                alert('Ocorreu um erro na comunica√ß√£o com o servidor. Verifique o console.');
            }
        });
    });
});
</script>
{% endblock %}